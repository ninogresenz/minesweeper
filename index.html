<!DOCTYPE html>
<html lang="en">
    <meta charset="utf-8" />
    <head>
        <title>Minesweeper</title>
        <style>
            .grid {
                width: 400px;
                height: 400px;
                display: flex;
                flex-wrap: wrap;
                margin: auto;
            }
            .grid div {
                background-color: grey;
                width: 40px;
                height: 40px;
                text-align: center;
                vertical-align: center;
                font-size: 30px;
                box-shadow: inset -1px -1px 2px 1px rgba(0,0,0,0.75);
                border-radius: 5px 5px 5px 5px;
            }
            .grid div:hover {
                background-color: lightgrey;
            }
            .clicked {
                background-color: lightgrey !important
            }
            .bomb {
                background-color: red !important;
            }
        </style>
        <script>
            document.addEventListener('DOMContentLoaded', createGame);
            const width = 10;
            const height = 10;
            const numberOfBombs = 5;
            const showIndizes = false;
            const squares = [];
            const empty = Array((width*height)-numberOfBombs).fill(0)
            const bombs = Array(numberOfBombs).fill('bomb')
            let tiles = shuffle([...empty, ...bombs])
            let isGameOver = false;
            let clicked = [];
            function resetGame() {
                for (let square of squares) {
                    square.classList.remove('bomb')
                    square.classList.remove('clicked')
                    square.innerText = '';
                }
                tiles = shuffle([...empty, ...bombs])
                clicked = [];
                generateNumbers()
                isGameOver = false
            }

            function shuffle(arr) {
                return arr.sort(() => Math.random() - 0.5)
            }

            function createGame() {
                const grid = document.getElementById('grid');
                for (let i = 0; i < width*height; i++) {
                    const square = document.createElement('div');
                    square.setAttribute('id', i.toString())
                    grid.appendChild(square)
                    squares.push(square)
                    square.addEventListener('click', () => click(square))
                    square.addEventListener('contextmenu', (e) => contextmenu(e, square))
                }
                const button = document.createElement('button')
                button.innerText = 'Restart Game'
                button.addEventListener('click', () => resetGame())
                document.body.appendChild(button)
                generateNumbers();
            }

            function generateNumbers() {
                for (let [index, tile] of tiles.entries()) {
                    if (showIndizes) squares[index].innerText = index.toString()
                    if (tile === 'bomb')
                        continue;
                    let total = 0;
                    if (!isTop(index) && tiles[topIndex(index)] === 'bomb') total++;
                    if (!isTop(index) && !isLeft(index) && tiles[topLeftIndex(index)] === 'bomb') total++;
                    if (!isTop(index) && !isRight(index) && tiles[topRightIndex(index)] === 'bomb') total++;
                    if (!isBottom(index) && tiles[bottomIndex(index)] === 'bomb') total++;
                    if (!isBottom(index) && !isLeft(index) && tiles[bottomLeftIndex(index)] === 'bomb') total++;
                    if (!isBottom(index) && !isRight(index) && tiles[bottomRightIndex(index)] === 'bomb') total++;
                    if (!isRight(index) && tiles[rightIndex(index)] === 'bomb') total++;
                    if (!isLeft(index) && tiles[leftIndex(index)] === 'bomb') total++;
                    tiles[index] = total
                }
            }

            function click(square) {
                if (!square) return;
                if (isGameOver) return;
                if (square.innerText === 'ðŸš©') return;
                const index = parseInt(square.id);
                if (clicked.includes(index)) return;
                if (tiles[index] === 'bomb') {
                    return showAllBombs()
                }
                if (tiles[index] !== 0) square.innerText = tiles[index] || square.innerText
                square.setAttribute('class', 'clicked')
                clicked.push(index)
                checkSurroundingTiles(index)
            }

            function showAllBombs() {
                for (let [index, tile] of tiles.entries()) {
                    if (tile !== 'bomb') continue
                    squares[index].setAttribute('class', 'bomb')
                    squares[index].innerText = 'ðŸ’£'
                }
                isGameOver = true
            }

            function checkSurroundingTiles(index) {
                if (tiles[index] !== 0) return;
                if (!isTop(index) && !clicked.includes(topIndex(index)))
                    click(squares[topIndex(index)]);
                if (!isTop(index) && !isLeft(index) && !clicked.includes(topLeftIndex(index)))
                    click(squares[topLeftIndex(index)]);
                if (!isTop(index) && !isRight(index) && !clicked.includes(topRightIndex(index)))
                    click(squares[topRightIndex(index)]);
                if (!isBottom(index) && !clicked.includes(bottomIndex(index)))
                    click(squares[bottomIndex(index)]);
                if (!isBottom(index) && !isLeft(index) && !clicked.includes(bottomLeftIndex(index)))
                    click(squares[bottomLeftIndex(index)]);
                if (!isBottom(index) && !isRight(index) && !clicked.includes(bottomRightIndex(index)))
                    click(squares[bottomRightIndex(index)]);
                if (!isRight(index) && !clicked.includes(rightIndex(index)))
                    click(squares[rightIndex(index)]);
                if (!isLeft(index) && !clicked.includes(leftIndex(index)))
                    click(squares[leftIndex(index)]);
            }

            function contextmenu(event, square) {
                event.preventDefault();
                if (clicked.includes(parseInt(square.id)) || isGameOver) return;
                if (square.innerText !== 'ðŸš©') {
                    square.innerText = 'ðŸš©'
                    return
                }
                square.innerText = showIndizes ? square.id : ''
            }

            function isLeft(number) {
                return number%width === 0
            }

            function isRight(number) {
                return number%width === width-1
            }

            function isTop(number) {
                return number >= 0 && number <= width-1
            }

            function isBottom(number) {
                return number >= ((width*height) - width) && number <= width*height
            }

            function topIndex(index) {
               return index-width;
            }

            function topLeftIndex(index) {
                return index-width-1
            }

            function topRightIndex(index) {
                return index-width+1;
            }

            function leftIndex(index) {
                return index-1;
            }

            function rightIndex(index) {
                return index+1;
            }

            function bottomIndex(index) {
                return index+width;
            }

            function bottomLeftIndex(index) {
                return index+width-1;
            }

            function bottomRightIndex(index) {
                return index+width+1;
            }
        </script>
    </head>
    <body>
        <div class="grid" id="grid"></div>
    </body>
</html>
